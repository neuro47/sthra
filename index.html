<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hra Mapa - Admin</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #mapa { width: 100vw; height: 100vh; background: url('mapa.png') no-repeat center center; background-size: contain; position: relative; }
        .bod { width: 32px; height: 32px; position: absolute; cursor: pointer; }
        #plusko { position: absolute; top: 20px; left: 20px; background: white; border: 2px solid black; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px; }
        #vyberIkony { position: absolute; background: white; border: 1px solid black; display: none; padding: 10px; }
        #vyberIkony img { width: 32px; height: 32px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="mapa">
        <div id="plusko">+</div>
        <div id="vyberIkony">
            <img src="svitilna.png" data-typ="svitilna">
            <img src="sirky.png" data-typ="sirky">
            <img src="radio.png" data-typ="radio">
        </div>
    </div>

    <script type="module">
        // Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, onChildAdded, onChildRemoved, push, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCEq2j2FUqRXDazNKstJY9ZmrrJZm6uQHc",
            authDomain: "st-hra-cd434.firebaseapp.com",
            databaseURL: "https://st-hra-cd434-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "st-hra-cd434",
            storageBucket: "st-hra-cd434.firebasestorage.app",
            messagingSenderId: "146462036985",
            appId: "1:146462036985:web:3b79d238564e11c77aa328"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const bodyRef = ref(db, 'body');

        const mapa = document.getElementById('mapa');
        const plusko = document.getElementById('plusko');
        const vyberIkony = document.getElementById('vyberIkony');

        let pridavani = false;
        let noveX = 0;
        let noveY = 0;

        plusko.addEventListener('click', () => {
            pridavani = true;
            alert('Klikni na místo na mapě pro přidání bodu');
        });

        mapa.addEventListener('click', (e) => {
            if (!pridavani) return;
            const rect = mapa.getBoundingClientRect();
            noveX = (e.clientX - rect.left) / rect.width;
            noveY = (e.clientY - rect.top) / rect.height;
            vyberIkony.style.left = `${e.clientX}px`;
            vyberIkony.style.top = `${e.clientY}px`;
            vyberIkony.style.display = 'block';
        });

        vyberIkony.addEventListener('click', (e) => {
            if (e.target.tagName === 'IMG') {
                const typ = e.target.dataset.typ;
                push(bodyRef, { x: noveX, y: noveY, typ });
                vyberIkony.style.display = 'none';
                pridavani = false;
            }
        });

        onChildAdded(bodyRef, (data) => {
            const { x, y, typ } = data.val();
            const bod = document.createElement('img');
            bod.src = `${typ}.png`;
            bod.classList.add('bod');
            bod.style.left = `${x * 100}%`;
            bod.style.top = `${y * 100}%`;
            bod.dataset.key = data.key;

            let holdTimeout;

            bod.addEventListener('mousedown', () => {
                holdTimeout = setTimeout(() => {
                    if (confirm('Chceš tento bod smazat?')) {
                        remove(ref(db, 'body/' + data.key));
                    }
                }, 1500);
            });

            bod.addEventListener('mouseup', () => {
                clearTimeout(holdTimeout);
            });

            mapa.appendChild(bod);
        });

        onChildRemoved(bodyRef, (data) => {
            const key = data.key;
            const bod = document.querySelector(`[data-key='${key}']`);
            if (bod) bod.remove();
        });
    </script>
</body>
</html>
